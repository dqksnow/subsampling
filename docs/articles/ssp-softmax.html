<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>`ssp.softmax`: Subsampling for Softmax (Multinomial) Regression Model • subsampling</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="`ssp.softmax`: Subsampling for Softmax (Multinomial) Regression Model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">subsampling</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ssp-logit.html">`ssp.glm`: Subsampling for Generalized Linear Models</a></li>
    <li><a class="dropdown-item" href="../articles/ssp-quantreg.html">`ssp.quantreg`: Subsampling for Quantile Regression</a></li>
    <li><a class="dropdown-item" href="../articles/ssp-relogit.html">`ssp.relogit`: Subsampling for Logistic Regression Model with Rare Events</a></li>
    <li><a class="dropdown-item" href="../articles/ssp-softmax.html">`ssp.softmax`: Subsampling for Softmax (Multinomial) Regression Model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dqksnow/Subsampling/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>`ssp.softmax`: Subsampling for Softmax (Multinomial) Regression Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dqksnow/Subsampling/blob/HEAD/vignettes/ssp-softmax.Rmd" class="external-link"><code>vignettes/ssp-softmax.Rmd</code></a></small>
      <div class="d-none name"><code>ssp-softmax.Rmd</code></div>
    </div>

    
    
<p>This vignette introduces the usage of <code>ssp.softmax</code>, which
draws optimal subsample from full data and fit softmax (multinomial)
regression on the subsample. The statistical theory and algorithms in
this implementation can be found in the relevant reference papers.</p>
<p>Denote
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
as multi-category response variable and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K+1</annotation></semantics></math>
is the number of categories.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is the number of observations in the full dataset.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">N
\times d</annotation></semantics></math> covariates matrix. Softmax
regression model assumes that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>,</mo><mi>k</mi></mrow></msub><mo>=</mo><mn>1</mn><mo>∣</mo><msub><mi>𝐱</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>𝐱</mi><mi>i</mi><mi>⊤</mi></msubsup><msub><mi>𝛃</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><munderover><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></munderover><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>𝐱</mi><mi>i</mi><mi>⊤</mi></msubsup><msub><mi>𝛃</mi><mi>l</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
P(y_{i,k} = 1 \mid \mathbf{x}_i) = \frac{\exp(\mathbf{x}_i^\top \boldsymbol{\beta}_k)}{\sum_{l=0}^{K} \exp(\mathbf{x}_i^\top \boldsymbol{\beta}_l)}
</annotation></semantics></math> for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">i = 1, \ldots, N</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k = 0, 1, \ldots, K</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛃</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_k</annotation></semantics></math>’s
are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>-dimensional
unknown coefficients.</p>
<p>The log-likelihood function of softmax regression is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>max</mo><mi>β</mi></munder><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo stretchy="true" form="prefix">[</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></munderover><msub><mi>y</mi><mrow><mi>i</mi><mo>,</mo><mi>k</mi></mrow></msub><msubsup><mi>𝐱</mi><mi>i</mi><mi>⊤</mi></msubsup><msub><mi>𝛃</mi><mi>k</mi></msub><mo>−</mo><mo>ln</mo><mrow><mo stretchy="true" form="prefix">{</mo><munderover><mo>∑</mo><mrow><mi>l</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></munderover><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>𝐱</mi><mi>i</mi><mi>⊤</mi></msubsup><msub><mi>𝛃</mi><mi>l</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\max_{\beta} L(\beta) = \frac{1}{N} \sum_{i=1}^{N} \left[ \sum_{k=0}^{K} y_{i,k}
\mathbf{x}_i^\top \boldsymbol{\beta}_k - \ln \left\{ \sum_{l=0}^{K}
\exp(\mathbf{x}_i^\top \boldsymbol{\beta}_l) \right\} \right].
</annotation></semantics></math></p>
<p>The idea of subsampling methods is as follows: instead of fitting the
model on the size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
full dataset, a subsampling probability is assigned to each observation
and a smaller, informative subsample is drawn. The model is then fitted
on the subsample to obtain an estimator with reduced computational
cost.</p>
<div class="section level2">
<h2 id="terminology">Terminology<a class="anchor" aria-label="anchor" href="#terminology"></a>
</h2>
<ul>
<li><p>Full dataset: The whole dataset used as input.</p></li>
<li><p>Full data estimator: The estimator obtained by fitting the model
on the full dataset.</p></li>
<li><p>Subsample: A subset of observations drawn from the full
dataset.</p></li>
<li><p>Subsample estimator: The estimator obtained by fitting the model
on the subsample.</p></li>
<li><p>Subsampling probability
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>):
The probability assigned to each observation for inclusion in the
subsample.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We introduce the usage of <code>ssp.softmax</code> with simulated
data.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
contains
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">d=3</annotation></semantics></math>
covariates drawn from multinormal distribution and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is the multicategory response variable with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>+</mo><mn>1</mn><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">K+1=3</annotation></semantics></math>
categories. The full data size is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mn>1</mn><mo>×</mo><msup><mn>10</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">N = 1 \times
10^4</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dqksnow/subsampling" class="external-link">subsampling</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">K</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, <span class="va">K</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">K</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">%x%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1e4</span></span>
<span><span class="va">beta.true.baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">d</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="va">d</span>, <span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta.true.summation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">d</span><span class="op">)</span>, <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="va">d</span>, <span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.5</span>, nrow <span class="op">=</span> <span class="va">d</span>, ncol <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta.true.summation</span><span class="op">)</span></span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="va">prob</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">prob</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">K</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">row</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Y         V1          V2         V3</span></span>
<span><span class="co">#&gt; 1 2 -0.3756189 -0.17727086 -0.9816025</span></span>
<span><span class="co">#&gt; 2 2  0.2912939  0.60753208 -0.4489936</span></span>
<span><span class="co">#&gt; 3 2 -1.0530547  0.02079337 -1.0146024</span></span>
<span><span class="co">#&gt; 4 0  0.1854791  2.45385260  1.2682922</span></span>
<span><span class="co">#&gt; 5 0  0.8687332  0.21941612 -0.2810234</span></span>
<span><span class="co">#&gt; 6 1 -0.8336174 -0.32556141 -0.8505501</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="key-arguments">Key Arguments<a class="anchor" aria-label="anchor" href="#key-arguments"></a>
</h2>
<p>The function usage is</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ssp.softmax.html">ssp.softmax</a></span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  <span class="va">n.plt</span>,</span>
<span>  <span class="va">n.ssp</span>,</span>
<span>  criterion <span class="op">=</span> <span class="st">"MSPE"</span>,</span>
<span>  sampling.method <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  likelihood <span class="op">=</span> <span class="st">"MSCLE"</span>,</span>
<span>  constraint <span class="op">=</span> <span class="st">"summation"</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The core functionality of <code>ssp.softmax</code> revolves around
three key questions:</p>
<ul>
<li><p>How are subsampling probabilities computed? (Controlled by the
<code>criterion</code> argument)</p></li>
<li><p>How is the subsample drawn? (Controlled by the
<code>sampling.method</code> argument)</p></li>
<li><p>How is the likelihood adjusted to correct for bias? (Controlled
by the <code>likelihood</code> argument)</p></li>
</ul>
<div class="section level3">
<h3 id="criterion">
<code>criterion</code><a class="anchor" aria-label="anchor" href="#criterion"></a>
</h3>
<p>The choices of <code>criterion</code> include <code>optA</code>,
<code>optL</code>, ,<code>MSPE</code>(default), <code>LUC</code> and
<code>uniform</code>. The default criterion <code>MSPE</code> minimizes
the mean squared prediction error between subsample estimator and full
data estimator. Criterion <code>optA</code> and <code>optL</code> are
derived by minimizing the asymptotic covariance of subsample estimator.
<code>LUC</code> and <code>uniform</code> are baseline methods. See
<span class="citation">Yao, Zou, and Wang (2023)</span> and <span class="citation">Wang and Kim (2022)</span> for details.</p>
</div>
<div class="section level3">
<h3 id="sampling-method">
<code>sampling.method</code><a class="anchor" aria-label="anchor" href="#sampling-method"></a>
</h3>
<p>The options for <code>sampling.method</code> include
<code>withReplacement</code> and <code>poisson</code> (default).
<code>withReplacement.</code> stands for drawing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>.</mi><mi>s</mi><mi>s</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">n.ssp</annotation></semantics></math>
subsamples from full dataset with replacement, using the specified
subsampling probability. <code>poisson</code> stands for drawing
subsamples one by one by comparing the subsampling probability with a
realization of uniform random variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">U(0,1)</annotation></semantics></math>.
The expected number of drawed samples are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>.</mi><mi>s</mi><mi>s</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">n.ssp</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="likelihood">
<code>likelihood</code><a class="anchor" aria-label="anchor" href="#likelihood"></a>
</h3>
<p>The available choices for <code>likelihood</code> include
<code>weighted</code> and <code>MSCLE</code>(default).
<code>MSCLE</code> stands for maximum sampled conditional likelihood.
Both of these likelihood functions can derive an unbiased optimal
subsample estimator. See <span class="citation">Wang and Kim
(2022)</span> for details about <code>MSCLE</code>.</p>
</div>
<div class="section level3">
<h3 id="constraint">
<code>constraint</code><a class="anchor" aria-label="anchor" href="#constraint"></a>
</h3>
<p>Softmax model needs constraint on unknown coefficients for
identifiability. The options for <code>constraint</code> include
<code>summation</code> and <code>baseline</code> (default). The baseline
constraint assumes the coefficient for the baseline category are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>.
Without loss of generality, <code>ssp.softmax</code> sets the category
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y=0</annotation></semantics></math>
as the baseline category so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝛃</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\boldsymbol{\beta}_0=0</annotation></semantics></math>.
The summation constraint
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></msubsup><msub><mi>𝛃</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">\sum_{k=0}^{K} \boldsymbol{\beta}_k</annotation></semantics></math>
can also used in the subsampling method for the purpose of calculating
optimal subsampling probability. These two constraints lead to different
interpretation of coefficients but are equal for computing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>,</mo><mi>k</mi></mrow></msub><mo>=</mo><mn>1</mn><mo>∣</mo><msub><mi>𝐱</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(y_{i,k} = 1 \mid \mathbf{x}_i)</annotation></semantics></math>.
The estimation of coefficients returned by <code><a href="../reference/ssp.softmax.html">ssp.softmax()</a></code> is
under baseline constraint.</p>
</div>
</div>
<div class="section level2">
<h2 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h2>
<p>After drawing subsample, <code>ssp.softmax</code> utilizes
<code><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">nnet::multinom</a></code> to fit the model on the subsample. Arguments
accepted by <code><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">nnet::multinom</a></code> can be passed through
<code>...</code> in <code>ssp.softmax</code>.</p>
<p>Below are two examples demonstrating the use of
<code>ssp.softmax</code> with different configurations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.plt</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">n.ssp</span> <span class="op">&lt;-</span> <span class="fl">600</span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">ssp.results1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssp.softmax.html">ssp.softmax</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                            n.plt <span class="op">=</span> <span class="va">n.plt</span>,</span>
<span>                            n.ssp <span class="op">=</span> <span class="va">n.ssp</span>,</span>
<span>                            criterion <span class="op">=</span> <span class="st">'MSPE'</span>,</span>
<span>                            sampling.method <span class="op">=</span> <span class="st">'withReplacement'</span>,</span>
<span>                            likelihood <span class="op">=</span> <span class="st">'weighted'</span>,</span>
<span>                            constraint <span class="op">=</span> <span class="st">'baseline'</span></span>
<span>                            <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Message from nnet::multinom: "</span></span>
<span><span class="co">#&gt; # weights:  12 (6 variable)</span></span>
<span><span class="co">#&gt; initial  value 219.722458 </span></span>
<span><span class="co">#&gt; iter  10 value 143.304799</span></span>
<span><span class="co">#&gt; final  value 143.304778 </span></span>
<span><span class="co">#&gt; converged</span></span>
<span><span class="co">#&gt; [1] "Message from nnet::multinom: "</span></span>
<span><span class="co">#&gt; # weights:  12 (6 variable)</span></span>
<span><span class="co">#&gt; initial  value 5789394.068697 </span></span>
<span><span class="co">#&gt; iter  10 value 4219770.981211</span></span>
<span><span class="co">#&gt; final  value 4219003.340996 </span></span>
<span><span class="co">#&gt; converged</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssp.results1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ssp.softmax(formula = formula, data = data, n.plt = n.plt, n.ssp = n.ssp, </span></span>
<span><span class="co">#&gt;     criterion = "MSPE", sampling.method = "withReplacement", </span></span>
<span><span class="co">#&gt;     likelihood = "weighted", constraint = "baseline")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Subsample Size:</span></span>
<span><span class="co">#&gt;                                </span></span>
<span><span class="co">#&gt; 1       Total Sample Size 10000</span></span>
<span><span class="co">#&gt; 2 Expected Subsample Size   600</span></span>
<span><span class="co">#&gt; 3   Actual Subsample Size   600</span></span>
<span><span class="co">#&gt; 4   Unique Subsample Size   563</span></span>
<span><span class="co">#&gt; 5  Expected Subample Rate    6%</span></span>
<span><span class="co">#&gt; 6    Actual Subample Rate    6%</span></span>
<span><span class="co">#&gt; 7    Unique Subample Rate 5.63%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         [,1]      [,2]</span></span>
<span><span class="co">#&gt; V1 -1.175907 -1.281935</span></span>
<span><span class="co">#&gt; V2 -1.619482 -1.502412</span></span>
<span><span class="co">#&gt; V3 -1.231662 -1.414723</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Std. Errors:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         [,1]      [,2]</span></span>
<span><span class="co">#&gt; V1 0.1457377 0.1459830</span></span>
<span><span class="co">#&gt; V2 0.1442445 0.1461619</span></span>
<span><span class="co">#&gt; V3 0.1498036 0.1492071</span></span></code></pre></div>
<p><code>summary(ssp.results1)</code> shows that it draws 600
observations out of 10000, where the number of unique indices is less
than 600 since we use <code>sampling.method = 'withReplacement'</code>.
After fitting softmax model on subsample using the choosen
<code>weighted</code> likelihood function, we get coefficients
estimation and standard errors as above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssp.results2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ssp.softmax.html">ssp.softmax</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                            n.plt <span class="op">=</span> <span class="va">n.plt</span>,</span>
<span>                            n.ssp <span class="op">=</span> <span class="va">n.ssp</span>,</span>
<span>                            criterion <span class="op">=</span> <span class="st">'MSPE'</span>,</span>
<span>                            sampling.method <span class="op">=</span> <span class="st">'poisson'</span>,</span>
<span>                            likelihood <span class="op">=</span> <span class="st">'MSCLE'</span>,</span>
<span>                            constraint <span class="op">=</span> <span class="st">'baseline'</span></span>
<span>                            <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Message from nnet::multinom: "</span></span>
<span><span class="co">#&gt; # weights:  12 (6 variable)</span></span>
<span><span class="co">#&gt; initial  value 219.722458 </span></span>
<span><span class="co">#&gt; iter  10 value 126.651711</span></span>
<span><span class="co">#&gt; final  value 126.637171 </span></span>
<span><span class="co">#&gt; converged</span></span>
<span><span class="co">#&gt; [1] "Message from nnet::multinom: "</span></span>
<span><span class="co">#&gt; # weights:  21 (6 variable)</span></span>
<span><span class="co">#&gt; initial  value 908.207717 </span></span>
<span><span class="co">#&gt; iter  10 value 651.150361</span></span>
<span><span class="co">#&gt; final  value 650.943777 </span></span>
<span><span class="co">#&gt; converged</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ssp.results2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Model Summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ssp.softmax(formula = formula, data = data, n.plt = n.plt, n.ssp = n.ssp, </span></span>
<span><span class="co">#&gt;     criterion = "MSPE", sampling.method = "poisson", likelihood = "MSCLE", </span></span>
<span><span class="co">#&gt;     constraint = "baseline")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Subsample Size:</span></span>
<span><span class="co">#&gt;                                </span></span>
<span><span class="co">#&gt; 1       Total Sample Size 10000</span></span>
<span><span class="co">#&gt; 2 Expected Subsample Size   600</span></span>
<span><span class="co">#&gt; 3   Actual Subsample Size   702</span></span>
<span><span class="co">#&gt; 4   Unique Subsample Size   702</span></span>
<span><span class="co">#&gt; 5  Expected Subample Rate    6%</span></span>
<span><span class="co">#&gt; 6    Actual Subample Rate 7.02%</span></span>
<span><span class="co">#&gt; 7    Unique Subample Rate 7.02%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         [,1]      [,2]</span></span>
<span><span class="co">#&gt; V1 -1.450790 -1.434135</span></span>
<span><span class="co">#&gt; V2 -1.764387 -1.726621</span></span>
<span><span class="co">#&gt; V3 -1.448671 -1.607003</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Std. Errors:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         [,1]      [,2]</span></span>
<span><span class="co">#&gt; V1 0.1314360 0.1353568</span></span>
<span><span class="co">#&gt; V2 0.1441155 0.1413029</span></span>
<span><span class="co">#&gt; V3 0.1389344 0.1411973</span></span></code></pre></div>
<p>The returned object contains estimation results and index of drawn
subsamples in the full dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ssp.results1</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "model.call"            "coef.plt"              "coef.ssp"             </span></span>
<span><span class="co">#&gt;  [4] "coef"                  "coef.plt.sum"          "coef.ssp.sum"         </span></span>
<span><span class="co">#&gt;  [7] "coef.sum"              "cov.plt"               "cov.ssp"              </span></span>
<span><span class="co">#&gt; [10] "cov"                   "cov.plt.sum"           "cov.sum"              </span></span>
<span><span class="co">#&gt; [13] "cov.ssp.sum"           "index.plt"             "index.ssp"            </span></span>
<span><span class="co">#&gt; [16] "N"                     "subsample.size.expect" "terms"</span></span></code></pre></div>
<p>Some key returned variables:</p>
<ul>
<li><p><code>index.plt</code> and <code>index</code> are the row indices
of drawn pilot subsamples and optimal subsamples in the full
data.</p></li>
<li><p><code>coef.ssp</code> is the subsample estimator for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
and <code>coef</code> is the linear combination of <code>coef.plt</code>
(pilot estimator) and <code>coef.ssp</code>.</p></li>
<li><p><code>cov.ssp</code> and <code>cov</code> are estimated
covariance matrices of <code>coef.ssp</code> and
<code>coef</code>.</p></li>
</ul>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-wang2022maximum" class="csl-entry">
Wang, HaiYing, and Jae Kwang Kim. 2022. <span>“Maximum Sampled
Conditional Likelihood for Informative Subsampling.”</span> <em>Journal
of Machine Learning Research</em> 23 (332): 1–50.
</div>
<div id="ref-yao2023model" class="csl-entry">
Yao, Yaqiong, Jiahui Zou, and HaiYing Wang. 2023. <span>“Model
Constraints Independent Optimal Subsampling Probabilities for Softmax
Regression.”</span> <em>Journal of Statistical Planning and
Inference</em> 225: 188–201.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Qingkai Dong, Yaqiong Yao, Haiying Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
